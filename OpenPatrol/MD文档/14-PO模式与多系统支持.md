本文主要介绍当前框架的PO模式设计与如何进行多系统支持

# 1-PO模式简介

PO模型是:Page Object Model的简写 页面对象模型

作用：就是把测试页面和测试脚本进行分离，即把页面元素和方法封装，供测试脚本进行调用;

分层机制，让不同层去做不同类型的事情，让代码结构清晰，增加复用性。

PO设计模式UI自动化测试中最佳的设计模式之一，主要体现在对界面交互细节的封装

优点： 提高代码的可读性 减少了代码的重复 提高代码的可维护性，特别是针对UI界面频繁的项目

缺点： 造成项目结构比较复杂，因为是根据流程进行了模块化处理

# 2-元素封装

PO模式的核心是基于元素封装，因此基于PO模式的理念，我们进行类似的元素封装定义，我们将页面元素抽象为**Element**，包含：**元素选择器，元素内容，自定义信息**。

在test/automation/pages/Element.js 

```javascript
const Element = (selector, content, msg) => ({selector, content, msg});
module.exports = Element;
```

![image-20220627143627498](/Users/wulei/Library/Application Support/typora-user-images/image-20220627143627498.png)

因此一个通用的页面模型包含：N*Element+页面方法

# 3-登陆优化

基于上面的分析，博客园的登陆页面抽象：多个元素+登陆方法

新建：test/automation/pages/Blog/LoginBlogPage.js

每一个页面都包含：元素封装+常见方法

```javascript
const Element = require('../Element');
const LoginBlogPage = {
    //元素封装
    
    //常见方法

}
module.exports=LoginBlogPage;
```

![image-20220627144646195](/Users/wulei/Library/Application Support/typora-user-images/image-20220627144646195.png)

## 1-登陆元素封装

cookie登陆过程中，我们针对cookie校验不通过时，需要进行重新的登陆，登陆过程就是针对元素的处理；

![image-20220627144244411](/Users/wulei/Library/Application Support/typora-user-images/image-20220627144244411.png)

上述流程可以抽象为：

1个登陆URL：https://account.cnblogs.com/signin

5个元素：密码登陆按钮，用户名输入，密码输入，记住我单选框，登陆按钮

1个登陆方法：

![image-20220627150520903](/Users/wulei/Library/Application Support/typora-user-images/image-20220627150520903.png)

```javascript
const Element = require('../Element');
const LoginBlogPage = {
    'login_url' : "https://account.cnblogs.com/signin",
    //元素封装
    'password_login':Element('#mat-tab-label-0-0 > div', '密码登录'),
    'name':Element('#mat-input-0', '登陆用户名/邮箱'),
    'password':Element('#mat-input-1', '密码'),
    'remember':Element('#mat-checkbox-1 > label > span.mat-checkbox-inner-container', '记住我'),
    'login_btn':Element('body > app-root > app-sign-in-layout > div > div > app-sign-in > app-content-container > div > div > div > form > div > button', '登录'),
    //常见方法

}
module.exports=LoginBlogPage;
```

## 2-登陆方法封装

封装密码登陆方法：实现和之前完全一样

```javascript
passwordLogin: async function (login_name,login_pwd) {
    //1. 登陆：博客园
    await page.goto(LoginBlogPage.login_url);
    //2. 点击：密码登陆
    await page.waitForSelector(LoginBlogPage.password_login.selector, {timeout: 2 * 1000}).then(ele => {
        ele.click()
    }).catch(e => {
        console.log(e)
    })
    //3. 输入：用户名
    await page.focus(LoginBlogPage.name.selector);
    await page.type(LoginBlogPage.name.selector, login_name);
    //4. 输入：密码
    await page.focus(LoginBlogPage.password.selector);
    await page.type(LoginBlogPage.password.selector, login_pwd);
    //5. 勾选：记住我（可选）
    // await page.click(LoginBlogPage.remember.selector);
    //6. 点击：登陆
    await page.waitForSelector(LoginBlogPage.login_btn.selector, {timeout: 2 * 1000}).then(ele => {
        ele.click()
    }).catch(e => {
        console.log(e)
    })
    //等待响应返回200
    await page.waitForResponse(response => response.status() === 200);
    await page.waitForTimeout(2000);
}
```

## 3-cookie登陆优化

修改：src/cookie/HandleCookie.js

登陆过程改为登陆页面操作

```javascript
const loginBlogPage = require('../../test/automation/pages/Blog/LoginBlogPage');

//PO模式登陆
await loginBlogPage.passwordLogin(login_name, login_pwd);
```

![image-20220627152308319](/Users/wulei/Library/Application Support/typora-user-images/image-20220627152308319.png)

## 4-巡检测试

运行巡检：test/patrol/PatrolTest.js

登陆过程正常

![image-20220627152416643](/Users/wulei/Library/Application Support/typora-user-images/image-20220627152416643.png)

# 4-拓展

## 拓展1:登陆页面

test/automation/pages/Blog/LoginBlogPage.js

可以封装更多的页面元素（例如：注册，忘记密码等），方法（短信登陆）

![image-20220627152939174](/Users/wulei/Library/Application Support/typora-user-images/image-20220627152939174.png)

## 拓展2:其他方式登陆

其他登陆校验，可以参考LoginBlogPage.js的封装，在HandleCookie.js登陆时进行替换就可以完成其他方式的登陆校验（例如：短信登陆流程，忘记密码流程等）

![image-20220627153103761](/Users/wulei/Library/Application Support/typora-user-images/image-20220627153103761.png)

## 拓展3:其他系统

对于其他系统，可以参考HandleCookie.js的登陆，创建登陆其他系统的校验方法：

![image-20220627153243748](/Users/wulei/Library/Application Support/typora-user-images/image-20220627153243748.png)

在用例时可以选择新系统的登陆校验：

![image-20220627153338145](/Users/wulei/Library/Application Support/typora-user-images/image-20220627153338145.png)

# 5-多系统支持

如果需要支持多系统（例如其他的WEB系统）或者多环境（预发，QA），可以参考上面的流程，只需要创建新的cookie配置+cookie文件+HandleCookie即可：

假设需要新增处理百度系统的相关操作：

## 1-src/config/config.js 

新增cookies_baidu文件配置

![image-20220627155228688](/Users/wulei/Library/Application Support/typora-user-images/image-20220627155228688.png)

## 2-新建cookie文件

新建：/src/cookie/cookiesBaidu.js ,初始化

```yaml
[{"name":"modTime","time":"1655889493696","login_name":"UI自动化"}]
```

## 3-src/cookie/HandleCookie.js

新建登陆方法，只需要替换cookieFile的位置即可（登陆页面封装参考前面的登陆优化）

![image-20220627155432930](/Users/wulei/Library/Application Support/typora-user-images/image-20220627155432930.png)